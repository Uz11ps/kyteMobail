# Настройка AWS SNS для отправки SMS

## Какие данные нужны от заказчика

Для работы с AWS SNS необходимо получить следующие данные:

### 1. AWS Access Key ID
- Это публичный ключ доступа к AWS API
- Выглядит как: `AKIAIOSFODNN7EXAMPLE`

### 2. AWS Secret Access Key
- Это секретный ключ доступа к AWS API
- Выглядит как: `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`
- ⚠️ **ВАЖНО**: Этот ключ показывается только один раз при создании! Его нужно сохранить.

### 3. AWS Region (регион)
- Регион AWS, где будет работать сервис
- Примеры: `us-east-1`, `eu-west-1`, `eu-central-1`, `us-west-2`
- По умолчанию можно использовать: `us-east-1`

## Как заказчик может получить эти данные

### Шаг 1: Войти в AWS Console
1. Перейти на https://console.aws.amazon.com/
2. Войти в аккаунт

### Шаг 2: Создать IAM пользователя (рекомендуется)
1. Перейти в **IAM** (Identity and Access Management)
2. Выбрать **Users** → **Add users**
3. Ввести имя пользователя (например: `kyte-sms-service`)
4. Выбрать тип доступа: **Programmatic access** (для API ключей)
5. Нажать **Next: Permissions**

### Шаг 3: Настроить права доступа
1. Выбрать **Attach existing policies directly**
2. Найти и выбрать политику: **AmazonSNSFullAccess** (или создать кастомную с минимальными правами)
3. Нажать **Next: Tags** (можно пропустить)
4. Нажать **Next: Review**
5. Проверить настройки и нажать **Create user**

### Шаг 4: Сохранить ключи доступа
1. После создания пользователя отобразится:
   - **Access Key ID** (скопировать)
   - **Secret Access Key** (скопировать и сохранить! Больше не будет показан)
2. Нажать **Download .csv** для сохранения ключей

## Минимальные права доступа (для безопасности)

Если заказчик хочет ограничить права доступа только отправкой SMS, можно создать кастомную политику:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "sns:Publish"
      ],
      "Resource": "*"
    }
  ]
}
```

## Настройка в проекте

После получения данных от заказчика, добавить в `.env` файл на сервере:

```env
SMS_PROVIDER=aws
AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
AWS_REGION=us-east-1
```

## Установка пакета

На сервере выполнить:
```bash
cd backend
npm install aws-sdk
```

## Проверка работы

После настройки можно протестировать отправку SMS через API:
```bash
curl -X POST http://localhost:3000/api/auth/phone/send-code \
  -H "Content-Type: application/json" \
  -d '{"phone": "+79991234567"}'
```

## Важные моменты

1. **Безопасность**: 
   - Никогда не коммитьте ключи в Git!
   - Храните их только в `.env` файле на сервере
   - Используйте переменные окружения

2. **Стоимость**:
   - AWS SNS взимает плату за отправку SMS (примерно $0.00645 за SMS в США)
   - Убедитесь, что у заказчика настроен billing в AWS

3. **Лимиты**:
   - AWS SNS имеет лимиты на отправку SMS
   - По умолчанию: 100 SMS в день для новых аккаунтов
   - Для увеличения лимита нужно запросить в AWS Support

4. **Поддержка стран**:
   - AWS SNS поддерживает отправку SMS в разные страны
   - Для России может потребоваться дополнительная настройка
   - Проверьте доступность сервиса для нужных стран

## Альтернатива: AWS SNS через SMS Sandbox

Для тестирования можно использовать AWS SNS Sandbox:
- Бесплатно для тестирования
- Ограниченное количество номеров (до 10)
- Нужно верифицировать номера телефонов в AWS Console

## Что запросить у заказчика

**Минимальный набор:**
1. AWS Access Key ID
2. AWS Secret Access Key  
3. AWS Region (или сказать использовать `us-east-1` по умолчанию)

**Дополнительно (для проверки):**
- Подтверждение, что у аккаунта AWS настроен billing
- Подтверждение, что нужные страны поддерживаются
- Информация о лимитах (если есть ограничения)

